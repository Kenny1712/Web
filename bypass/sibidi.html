<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bot Bypass Link Shorteners</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; }
  .chat-container { max-width:600px; margin:20px auto; padding:10px; }
  .msg { clear:both; margin:8px 0; padding:10px; border-radius:8px; max-width:80%; }
  .msg.user { float:right; background:#0084ff; color:white; text-align:right; }
  .msg.bot  { float:left;  background:#e4e6eb; color:black; text-align:left; }
  .input-area { display:flex; padding:10px; }
  .input-area input { flex:1; padding:10px; font-size:1em; border:1px solid #ccc; border-radius:4px; }
  .input-area button { padding:10px 20px; margin-left:10px; font-size:1em; background:#0084ff; color:white; border:none; border-radius:4px; cursor:pointer;}
  .input-area button:hover { background:#0073e6; }
</style>
</head>
<body>

<div class="chat-container" id="chat"></div>

<div class="input-area">
  <input type="text" id="input" placeholder="Nhập link rút gọn vào đây...">
  <button id="sendBtn">Gửi</button>
</div>

<script>
// Xử lý khi nhấn nút Gửi hoặc Enter
document.getElementById("sendBtn").addEventListener("click", sendLink);
document.getElementById("input").addEventListener("keydown", function(e) {
  if (e.key === "Enter") sendLink();
});

function sendLink() {
    let inputEl = document.getElementById("input");
    let link = inputEl.value.trim();
    if (!link) return;
    appendMessage(link, 'user');     // Hiển thị tin nhắn của user
    inputEl.value = '';
    processLink(link);
}

function appendMessage(text, sender) {
    let chat = document.getElementById("chat");
    let div = document.createElement("div");
    div.className = 'msg ' + (sender === 'user' ? 'user' : 'bot');
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function processLink(link) {
    // Kiểm tra loại link
    let lower = link.toLowerCase();
    if (!(lower.includes("linkvertise.com") || lower.includes("link4m.com") || lower.includes("yeumoney.com"))) {
        appendMessage("Loại link không được hỗ trợ", 'bot');
        return;
    }
    appendMessage("Đang xử lý...", 'bot');
    let url = encodeURIComponent(link);
    // Thử gọi API bypass.vip
    fetch("https://api.bypass.vip/bypass?url=" + url)
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                updateLastBot("Link gốc: " + data.result);
            } else {
                // Nếu fail, thử bypass.pm
                fetch("https://bypass.pm/bypass2?url=" + url)
                  .then(res2 => res2.json())
                  .then(data2 => {
                      if (data2.success) {
                          updateLastBot("Link gốc: " + data2.destination);
                      } else {
                          updateLastBot("Lỗi: " + (data2.msg || "Không thể lấy link gốc"));
                      }
                  }).catch(err2 => {
                      updateLastBot("Lỗi khi gọi API: " + err2);
                  });
            }
        })
        .catch(err => {
            // Nếu gọi bypass.vip lỗi, thử bypass.pm
            fetch("https://bypass.pm/bypass2?url=" + url)
                .then(res3 => res3.json())
                .then(data3 => {
                    if (data3.success) {
                        updateLastBot("Link gốc: " + data3.destination);
                    } else {
                        updateLastBot("Lỗi: " + (data3.msg || "Không thể lấy link gốc"));
                    }
                }).catch(err3 => {
                    updateLastBot("Lỗi khi gọi API: " + err3);
                });
        });
}

// Cập nhật nội dung tin nhắn bot cuối cùng
function updateLastBot(newText) {
    let msgs = document.getElementById("chat").getElementsByClassName("msg bot");
    if (msgs.length > 0) {
        msgs[msgs.length - 1].textContent = newText;
    }
}
</script>

</body>
</html>
